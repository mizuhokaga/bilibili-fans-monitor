name: Bç«™æ•°æ®æŠ“å–ä¸å­˜æ¡£
on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 4 * * *' # æ¯å¤©4ç‚¹è‡ªåŠ¨è¿è¡Œ

jobs:
  crawl-and-commit:
    runs-on: ubuntu-latest
    steps:
    # 1. æ£€å‡ºä»£ç 
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    # 2. è®¾ç½®Pythonç¯å¢ƒ
    - name: è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. å®‰è£…ä¾èµ–
    - name: å®‰è£…requests
      run: pip install requests

    # 4. è¿è¡Œä½ çš„æŠ“å–è„šæœ¬ (main.py)
    - name: è¿è¡ŒæŠ“å–è„šæœ¬
      run: python main.py

    # ğŸ‘‡ 5. ã€æ–°å¢æ­¥éª¤ã€‘æäº¤æ›´æ–°åçš„æ—¥å¿—æ–‡ä»¶åˆ°ä»“åº“
    - name: æäº¤å¹¶æ¨é€æ•°æ®æ–‡ä»¶
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        # å°†ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶æ·»åŠ åˆ°Git
        git add bilibili_data_log.txt
        # æäº¤æ›´æ”¹
        git commit -m "Auto-update Bç«™æ•°æ®æŠ“å–æ—¥å¿— [skip ci]" -a || echo "æ²¡æœ‰æ–°å†…å®¹å¯æäº¤"
        # æ¨é€å›ä»“åº“
        git push